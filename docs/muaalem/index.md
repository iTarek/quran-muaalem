# Quran Muaalem Overview

Quran Muaalem is the inference layer that compares a recitation to a reference phonetic script and emits phoneme + tajweed-related attributes. The main entry points are:

- `Muaalem` class in `src/quran_muaalem/inference.py`
- Gradio UI in `src/quran_muaalem/gradio_app.py`

## Core Inference Flow

Inside `Muaalem.__call__` (`src/quran_muaalem/inference.py`):

1. A phonetic reference is tokenized with `MultiLevelTokenizer`.
2. Audio is featurized with `AutoFeatureExtractor` from `transformers`.
3. The model `Wav2Vec2BertForMultilevelCTC` runs a forward pass.
4. Probabilities are decoded with `phonemes_level_greedy_decode` and `multilevel_greedy_decode` (`src/quran_muaalem/decode.py`).
5. Per-phoneme attributes are assembled into `Sifa` objects and returned as `MuaalemOutput`.

This design means you provide both audio and a reference phonetic script. The phonetic script is generated by `quran_transcript.quran_phonetizer`.

## Key Files

- `src/quran_muaalem/inference.py` — main model class and decode flow.
- `src/quran_muaalem/decode.py` — greedy decoders and alignment logic.
- `src/quran_muaalem/muaalem_typing.py` — output dataclasses (`Unit`, `Sifa`, `MuaalemOutput`).
- `src/quran_muaalem/gradio_app.py` — UI wiring and Moshaf attribute handling.
